'use strict';

const chalk = require('chalk');
const commander = require('commander');
const packageJson = require("../package.json");
const uglify = require('./uglify');

let sourceDir;
let distDir;

let defaultConfig = {
  distDir: 'dist'
};

const program = new commander.Command(packageJson.name)
  .version(packageJson.version)
  .arguments('<source-directory> [dist-directory]')
  .usage(`${chalk.green('<source-directory>')} [<dist-directory>] [options]`)
  .option('-m, --mangle', 'Enable mangle')
  .option('-s, --sourcemap', 'Enable source map')
  .action(function(source, dist) {
    sourceDir = source;
    distDir = dist;
  })
  .parse(process.argv);

if(typeof sourceDir === 'undefined') {
  console.error('Please specify the source directory:');
  console.log(
    `  ${chalk.cyan(program.name())} ${chalk.green('<source-directory>')}`
  );
  process.exit(1);
}


uglify(sourceDir, distDir || defaultConfig.distDir, program.mangle, program.sourcemap);

 console.log(chalk.yellow('Uglify success.'));